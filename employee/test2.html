<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Form</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.9.0/slick.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.9.0/slick-theme.css">
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/main1.css">
    <link rel="stylesheet" href="../css/main2.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>
    <div class="car-form"></div>
    <label for="numCars">Number of Cars:</label>
    <input type="number" id="numCars" value="0">

    <script>
        $(document).ready(function () {
            $('#numCars').on('input', function () {
                var numCars = $(this).val();
                var carForm = $('.car-form');
                carForm.empty(); // Clear previous form fields

                for (var i = 0; i < numCars; i++) {
                    var formFields = `

                    <div class="row fields">
                        <div class="col-12 my-2">
                           <h2 class="fs-4"> Car ${i + 1} Details</h2>
                        </div>
                        <div class="capture-main">
                            <div class="capture my-2">
                                <img id="imagePreview3_${i}" class="img-preview d-none" alt="Image Preview 3">
                                <label for="capture3_${i}" class="capture-btn text-white rounded-3 border-0 bg-black px-3 py-2">
                                    Capture Licence Plate Number 3
                                </label>
                                <input type="file" id="capture3_${i}" class="d-none" accept="image/*">
                            </div>
                        </div>
                        <div class="col-md-6 my-2">
                            <label for="date" class="w-100 font-md">Date</label>
                            <input type="text" class="border border-1 focus-none w-100 rounded-3 px-3 py-2">
                        </div>
                        <div class="col-md-6 my-2">
                            <label for="time" class="w-100 font-md">Time</label>
                            <input type="text" class="border border-1 focus-none w-100 rounded-3 px-3 py-2">
                        </div>
                        <div class="col-md-6 my-2">
                            <label for="name" class="w-100 font-md">Name</label>
                            <input type="text" class="border border-1 focus-none w-100 rounded-3 px-3 py-2">
                        </div>
                        <div class="col-md-6 my-2">
                            <label for="sname" class="w-100 font-md">Surname</label>
                            <input type="text" class="border border-1 focus-none w-100 rounded-3 px-3 py-2">
                        </div>
                        <div class="col-md-6 my-2">
                            <label for="company" class="w-100 font-md">Company</label>
                            <input type="text" class="border border-1 focus-none w-100 rounded-3 px-3 py-2">
                        </div>
                        <div class="col-md-6 my-2">
                            <label for="telephone" class="w-100 font-md">Telephone No.</label>
                            <input type="text" id="telephone"
                                class="border border-1 focus-none w-100 rounded-3 px-3 py-2 ">
                        </div>
                        <div class="col-md-6 my-2">
                            <label for="insurance_id" class="w-100 font-md">Insurance ID</label>
                            <input type="text" class="border border-1 focus-none w-100 rounded-3 px-3 py-2">
                        </div>
                        <div class="col-md-6 my-2">
                            <label for="insurance_com" class="w-100 font-md">Insurance Company</label>
                            <input type="text" class="border border-1 focus-none w-100 rounded-3 px-3 py-2">
                        </div>
                        <div class="col-md-6 my-2">
                            <label for="fault" class="w-100 font-md">Acknowledgment of Fault</label>
                            <textarea rows="6" class="border border-1 focus-none w-100 rounded-3 px-3 py-2"></textarea>
                        </div>
                        <div class="col-md-6 my-2">
                            <label for="info" class="w-100 font-md">Information</label>
                            <textarea rows="6" class="border border-1 focus-none w-100 rounded-3 px-3 py-2"></textarea>
                        </div>
                        <div class="my-2">
                            <h2 class="fs-6 font-medium">Car Damage Images</h2>
                            <p>Add Multiple images of Damage from Different angles</p>
                            <div class="d-flex flex-wrap align-items-center border border-1 p-2 rounded-3 mt-3">
                                <div class="img-m d-flex flex-wrap"></div>
                                <i class="fas fa-plus text-white bg-gold px-2 py-2 pointer add-input"></i>
                            </div>
                        </div>
                    </div>
                    `;
                    carForm.append(formFields);

                    // Attach image preview functionality to the newly created input
                    setupImagePreview(`capture3_${i}`, `imagePreview3_${i}`);
                }
            });

            function setupImagePreview(captureId, imagePreviewId) {
                document.getElementById(captureId).addEventListener('change', function (event) {
                    const fileInput = event.target;
                    const file = fileInput.files[0];
                    const imagePreview = document.getElementById(imagePreviewId);

                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function (e) {
                            imagePreview.src = e.target.result;
                            imagePreview.classList.remove('d-none');
                        }
                        reader.readAsDataURL(file);
                    } else {
                        imagePreview.classList.add('d-none');
                    }
                });
            }

            // Delegate the click event to a static parent element
            $(document).on("click", ".add-input", function () {
                var container = $(this).closest(".d-flex");
                var newInput = $('<input type="file" class="d-none image-input" name="images[]" required>');
                var newPreview = $('<img src="" alt="Image Preview" class="img-preview me-2 d-none">');
                container.find(".img-m").append(newInput);
                container.find(".img-m").append(newPreview);

                // Attach change event handler to the newly created input
                newInput.change(function () {
                    var fileInput = $(this);
                    var file = fileInput[0].files[0];
                    var preview = fileInput.next(".img-preview");

                    if (file) {
                        fileInput.addClass("d-none");
                        var reader = new FileReader();
                        reader.onload = function (e) {
                            preview.attr("src", e.target.result);
                            preview.removeClass("d-none");
                        };
                        reader.readAsDataURL(file);
                    }
                });

                // Trigger click event to open file dialog
                newInput.click();
            });
        });
    </script>
</body>

</html>